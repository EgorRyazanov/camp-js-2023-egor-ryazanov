var d=Object.defineProperty;var x=(s,t,e)=>t in s?d(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var n=(s,t,e)=>(x(s,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";function o(s,t,e="beforeend"){s&&t&&s.insertAdjacentElement(e,t)}function c(s){const t=document.createElement("div");return t.innerHTML=s,t.firstChild}function p(s,t){s.replaceWith(t)}function m(s){return s.reduce((t,e)=>t+e,0)}class l{getElement(){return this.element?this.element:c(this.getTemplate())}}class y extends l{constructor(e=[]){super();n(this,"points");n(this,"element");this.points=e,this.element=this.getElement()}getTemplate(){return`<div class="scores__total">
      <h4 class="total__title">Total</h4>
      <h4 class="total__scores">${m(this.points||[])}</h4>
      <div class="total__text-container">
        <p class="total__text">${(this.points||[]).join(" ")}</p>
      </div>
    </div>`}update(e){this.points.push(e.turnPoints);const i=this.element,r=c(this.getTemplate());p(i,r),this.element=r}}class g extends l{constructor(e,i){super();n(this,"element");n(this,"points");n(this,"name");this.points=e,this.name=i,this.element=this.getElement()}getPlayerTemplate(e=!1,i=!1){return`<li class="scores__player player">
      <h4 class="player__name ${i?"player__name_next":""}">${this.name}</h4>
      <h4 class="player__scores">Scores: ${m(this.points)}</h4>
      <div class="player__text-container ${e?"player__text-container_win":""}">
        <p class="player__text text">${this.points.join(" ")}</p>
      <div>
    </li>`}getTemplate(){return this.getPlayerTemplate()}update(e){this.points=e.points;const i=this.element,r=c(this.getPlayerTemplate(e.isWin,e.isNext));p(i,r),this.element=r}}class E extends l{constructor(){super();n(this,"element");this.element=this.getElement()}getTemplate(){return'<ul class="scores__players"></ul>'}}class _ extends l{constructor(){super();n(this,"element");this.element=this.getElement()}getTemplate(){return'<button class="primary-button game__roll-button">Make roll</button>'}addEvents(...e){e.forEach(i=>{this.getElement().addEventListener(i[0],i[1])})}}class w extends l{constructor(e){super();n(this,"element");n(this,"title");this.title=e,this.element=this.getElement()}getTemplate(){return`<h1 class="game__title title">${this.title}</h1>`}}class b extends l{constructor(){super();n(this,"element");this.element=this.getElement()}getTemplate(){return'<div class="game__scores"></div>'}}class h{constructor(){n(this,"subscribers",[])}subscribe(t){this.subscribers.findIndex(i=>i===t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.findIndex(i=>i===t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}}class f extends h{constructor(e){super();n(this,"currentPlayerIndex");n(this,"playerCount");this.next=this.next.bind(this),this.playerCount=e,this.currentPlayerIndex=-1}calculateIndex(e){let i=e+1;return this.playerCount===i&&(i=0),i}next(){this.currentPlayerIndex=this.calculateIndex(this.currentPlayerIndex);const e=this.calculateIndex(this.currentPlayerIndex);this.notify({nextPlayerIndex:e,currentPlayerIndex:this.currentPlayerIndex})}}const I=21,u=1,P=6;class V extends h{constructor(){super()}getRandomValue(){return Math.floor(Math.random()*(P+1-u)+u)}update(t){const e=this.getRandomValue();this.notify({turnPoints:e,currentPlayerIndex:t.currentPlayerIndex,nextPlayerIndex:t.nextPlayerIndex})}}class C extends h{constructor(e,i){super();n(this,"name");n(this,"index");n(this,"points");n(this,"isWin");n(this,"pointsSum");this.name=e,this.index=i,this.points=[],this.isWin=!1,this.pointsSum=0}update(e){e.currentPlayerIndex===this.index&&(this.points.push(e.turnPoints),this.pointsSum+=e.turnPoints,this.pointsSum>=I&&(this.isWin=!0),this.notify({isWin:this.isWin,pointsSum:this.pointsSum,points:this.points})),e.nextPlayerIndex===this.index&&this.notify({isWin:this.isWin,isNext:!0,pointsSum:this.pointsSum,points:this.points})}}class S{constructor(t,e,i){n(this,"app");n(this,"playersContainer");n(this,"rollButton");n(this,"playersGenerators");n(this,"playersViews");n(this,"totalScoresView");n(this,"title");n(this,"scoresContainerView");n(this,"turnGenerator");n(this,"diceGenerator");this.app=t,this.playersContainer=e,this.playersGenerators=[],this.playersViews=[],this.totalScoresView=new y,this.rollButton=new _,this.title=new w("Blackjack game"),this.scoresContainerView=new b,this.turnGenerator=new f(i.length),this.diceGenerator=new V,this.turnGenerator.subscribe(this.diceGenerator),this.diceGenerator.subscribe(this.totalScoresView),this.rollButton.addEvents(["click",this.turnGenerator.next]),i.forEach((r,a)=>{this.playersGenerators.push(new C(r,a)),this.diceGenerator.subscribe(this.playersGenerators[a])}),this.playersGenerators.forEach(r=>{const a=new g(r.points,r.name);this.playersViews.push(a),r.subscribe(a)})}init(){o(this.app,this.title.getElement()),o(this.app,this.rollButton.getElement()),o(this.app,this.scoresContainerView.getElement()),o(this.scoresContainerView.getElement(),this.playersContainer.getElement()),this.playersViews.forEach(t=>o(this.playersContainer.getElement(),t.getElement())),o(this.scoresContainerView.getElement(),this.totalScoresView.getElement())}}window.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("app"),t=new E,e=["John","Jack"];s&&e.length>0&&new S(s,t,e).init()});
