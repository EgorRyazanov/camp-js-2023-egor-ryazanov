var m=Object.defineProperty;var d=(r,t,e)=>t in r?m(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>(d(r,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";function a(r,t,e="beforeend"){r.insertAdjacentElement(e,t)}function c(r){const t=document.createElement("div");return t.innerHTML=r,t.firstChild}function u(r,t){r.replaceWith(t)}function p(r){return r.reduce((t,e)=>t+e,0)}class l{getElement(){return this.element}generateElement(t){return c(t||this.template)}}class y extends l{constructor(e=[]){super();s(this,"points");s(this,"element");this.points=e,this.element=this.generateElement()}get template(){return`<div class="scores__total">
      <h4 class="total__title">Total</h4>
      <h4 class="total__scores">${p(this.points)}</h4>
      <div class="total__text-container">
        <p class="total__text">${this.points.join(" ")}</p>
      </div>
    </div>`}update(e){this.points.push(e.turnPoints);const n=this.element,i=this.generateElement();u(n,i),this.element=i}}class E extends l{constructor(e,n){super();s(this,"element");s(this,"points");s(this,"name");this.points=e,this.name=n,this.element=this.generateElement()}get template(){return this.getPlayerTemplate()}update(e){this.points=e.points;const n=this.element,i=this.generateElement(this.getPlayerTemplate(e.isWin,e.isNext));u(n,i),this.element=i}getPlayerTemplate(e=!1,n=!1){return`<li class="scores__player player">
      <h4 class="player__name ${n?"player__name_next":""}">${this.name}</h4>
      <h4 class="player__scores">Scores: ${p(this.points)}</h4>
      <div class="player__text-container ${e?"player__text-container_win":""}">
        <p class="player__text text">${this.points.join(" ")}</p>
      <div>
    </li>`}}class x extends l{constructor(){super();s(this,"element");this.element=this.generateElement()}get template(){return'<ul class="scores__players"></ul>'}}class w extends l{constructor(){super();s(this,"element");s(this,"events");this.element=this.generateElement(),this.events=[]}get template(){return'<button class="primary-button game__roll-button">Make roll</button>'}addEvents(e){e.forEach(n=>{this.element.addEventListener(n.name,n.callback),this.events.push(n)})}removeEvents(){this.events.forEach(e=>{this.element.removeEventListener(e.name,e.callback)})}}class b extends l{constructor(e){super();s(this,"element");s(this,"title");this.title=e,this.element=this.generateElement()}get template(){return`<h1 class="game__title title">${this.title}</h1>`}}class _ extends l{constructor(){super();s(this,"element");this.element=this.generateElement()}get template(){return'<div class="game__scores"></div>'}}class o{constructor(){s(this,"subscribers",[])}subscribe(t){this.subscribers.findIndex(n=>n===t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.findIndex(n=>n===t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}}class g extends o{constructor(e){super();s(this,"currentPlayerIndex");s(this,"playerCount");this.next=this.next.bind(this),this.playerCount=e,this.currentPlayerIndex=-1}next(){this.currentPlayerIndex=this.calculateIndex(this.currentPlayerIndex);const e=this.calculateIndex(this.currentPlayerIndex);this.notify({nextPlayerIndex:e,currentPlayerIndex:this.currentPlayerIndex})}calculateIndex(e){const n=e+1;return this.playerCount===n?0:n}}const V=21,h=1,f=6,I=1;class P extends o{constructor(){super()}update(t){const e=this.getRandomValue();this.notify({turnPoints:e,currentPlayerIndex:t.currentPlayerIndex,nextPlayerIndex:t.nextPlayerIndex})}getRandomValue(){return Math.floor(Math.random()*(f+I-h)+h)}}class S extends o{constructor(e,n){super();s(this,"name");s(this,"points");s(this,"isWin");s(this,"pointsSum");s(this,"sequenceIndex");this.name=e,this.sequenceIndex=n,this.points=[],this.isWin=!1,this.pointsSum=0}update(e){e.currentPlayerIndex===this.sequenceIndex&&(this.points.push(e.turnPoints),this.pointsSum+=e.turnPoints,this.pointsSum>=V&&(this.isWin=!0),this.notify({isWin:this.isWin,pointsSum:this.pointsSum,points:this.points})),e.nextPlayerIndex===this.sequenceIndex&&this.notify({isWin:this.isWin,isNext:!0,pointsSum:this.pointsSum,points:this.points})}}class C{constructor(t,e,n){s(this,"appElement");s(this,"playersContainerView");s(this,"rollButtonView");s(this,"playersGenerators");s(this,"playersViews");s(this,"totalScoresView");s(this,"titleView");s(this,"scoresContainerView");s(this,"turnGenerator");s(this,"diceGenerator");this.appElement=t,this.playersContainerView=e,this.totalScoresView=new y,this.rollButtonView=new w,this.titleView=new b("Blackjack game"),this.scoresContainerView=new _,this.turnGenerator=new g(n.length),this.diceGenerator=new P,this.playersGenerators=this.createPlayerGenerators(n),this.playersViews=this.createPlayersViews()}init(){this.makeEventSubscribes(),a(this.appElement,this.titleView.getElement()),a(this.appElement,this.rollButtonView.getElement()),a(this.appElement,this.scoresContainerView.getElement()),a(this.scoresContainerView.getElement(),this.playersContainerView.getElement()),this.playersViews.forEach(t=>a(this.playersContainerView.getElement(),t.getElement())),a(this.scoresContainerView.getElement(),this.totalScoresView.getElement())}createPlayerGenerators(t){const e=[];return t.forEach((n,i)=>{e.push(new S(n,i))}),e}createPlayersViews(){const t=[];return this.playersGenerators.forEach(e=>{const n=new E(e.points,e.name);t.push(n),e.subscribe(n)}),t}makeEventSubscribes(){this.turnGenerator.subscribe(this.diceGenerator),this.diceGenerator.subscribe(this.totalScoresView),this.rollButtonView.addEvents([{name:"click",callback:this.turnGenerator.next}]),this.playersGenerators.forEach(t=>this.diceGenerator.subscribe(t))}}window.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector("#app"),t=new x,e=["John","Jack"];if(r==null)throw Error("Element not found");new C(r,t,e).init()});
