var y=Object.defineProperty;var w=(n,t,e)=>t in n?y(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(w(n,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";function l(n,t,e="beforeend"){n.insertAdjacentElement(e,t)}function h(n){const t=document.createElement("div");return t.innerHTML=n,t.firstChild}function d(n,t){n.replaceWith(t)}function x(n){return n.reduce((t,e)=>t+e,0)}class o{getElement(){return this.element?this.element:h(this.getTemplate())}}class E extends o{constructor(e=[]){super();s(this,"points");s(this,"element");this.points=e,this.element=this.getElement()}getTemplate(){return`<div class="scores__total">
      <h4 class="total__title">Total</h4>
      <h4 class="total__scores">${x(this.points)}</h4>
      <div class="total__text-container">
        <p class="total__text">${this.points.join(" ")}</p>
      </div>
    </div>`}update(e){this.points.push(e.turnPoints);const i=this.element,r=h(this.getTemplate());d(i,r),this.element=r}}class g extends o{constructor(e,i){super();s(this,"element");s(this,"points");s(this,"name");this.points=e,this.name=i,this.element=this.getElement()}getTemplate(){return this.getPlayerTemplate()}update(e){this.points=e.points;const i=this.element,r=h(this.getPlayerTemplate(e.isWin,e.isNext));d(i,r),this.element=r}getPlayerTemplate(e=!1,i=!1){return`<li class="scores__player player">
      <h4 class="player__name ${i?"player__name_next":""}">${this.name}</h4>
      <h4 class="player__scores">Scores: ${x(this.points)}</h4>
      <div class="player__text-container ${e?"player__text-container_win":""}">
        <p class="player__text text">${this.points.join(" ")}</p>
      <div>
    </li>`}}class _ extends o{constructor(){super();s(this,"element");this.element=this.getElement()}getTemplate(){return'<ul class="scores__players"></ul>'}}class V extends o{constructor(){super();s(this,"element");this.element=this.getElement()}getTemplate(){return'<button class="primary-button game__roll-button">Make roll</button>'}addEvents(...e){e.forEach(i=>{this.getElement().addEventListener(i[0],i[1])})}}class b extends o{constructor(e){super();s(this,"element");s(this,"title");this.title=e,this.element=this.getElement()}getTemplate(){return`<h1 class="game__title title">${this.title}</h1>`}}class f extends o{constructor(){super();s(this,"element");this.element=this.getElement()}getTemplate(){return'<div class="game__scores"></div>'}}class u{constructor(){s(this,"subscribers",[])}subscribe(t){this.subscribers.findIndex(i=>i===t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.findIndex(i=>i===t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}}class I extends u{constructor(e){super();s(this,"currentPlayerIndex");s(this,"playerCount");this.next=this.next.bind(this),this.playerCount=e,this.currentPlayerIndex=-1}next(){this.currentPlayerIndex=this.calculateIndex(this.currentPlayerIndex);const e=this.calculateIndex(this.currentPlayerIndex);this.notify({nextPlayerIndex:e,currentPlayerIndex:this.currentPlayerIndex})}calculateIndex(e){const i=e+1;return this.playerCount===i?0:i}}const P=21,m=1,C=6;class T extends u{constructor(){super()}update(t){const e=this.getRandomValue();this.notify({turnPoints:e,currentPlayerIndex:t.currentPlayerIndex,nextPlayerIndex:t.nextPlayerIndex})}getRandomValue(){return Math.floor(Math.random()*(C+1-m)+m)}}class S extends u{constructor(e,i){super();s(this,"name");s(this,"points");s(this,"isWin");s(this,"pointsSum");s(this,"index");this.name=e,this.index=i,this.points=[],this.isWin=!1,this.pointsSum=0}update(e){e.currentPlayerIndex===this.index&&(this.points.push(e.turnPoints),this.pointsSum+=e.turnPoints,this.pointsSum>=P&&(this.isWin=!0),this.notify({isWin:this.isWin,pointsSum:this.pointsSum,points:this.points})),e.nextPlayerIndex===this.index&&this.notify({isWin:this.isWin,isNext:!0,pointsSum:this.pointsSum,points:this.points})}}class G{constructor(t,e,i){s(this,"appElement");s(this,"playersContainerView");s(this,"rollButtonView");s(this,"playersGenerators");s(this,"playersViews");s(this,"totalScoresView");s(this,"titleView");s(this,"scoresContainerView");s(this,"turnGenerator");s(this,"diceGenerator");this.appElement=t,this.playersContainerView=e,this.totalScoresView=new E,this.rollButtonView=new V,this.titleView=new b("Blackjack game"),this.scoresContainerView=new f,this.turnGenerator=new I(i.length),this.diceGenerator=new T,this.turnGenerator.subscribe(this.diceGenerator),this.diceGenerator.subscribe(this.totalScoresView),this.rollButtonView.addEvents(["click",this.turnGenerator.next]);const r=[];i.forEach((a,c)=>{r.push(new S(a,c)),this.diceGenerator.subscribe(r[c])}),this.playersGenerators=r;const p=[];this.playersGenerators.forEach(a=>{const c=new g(a.points,a.name);p.push(c),a.subscribe(c)}),this.playersViews=p}init(){l(this.appElement,this.titleView.getElement()),l(this.appElement,this.rollButtonView.getElement()),l(this.appElement,this.scoresContainerView.getElement()),l(this.scoresContainerView.getElement(),this.playersContainerView.getElement()),this.playersViews.forEach(t=>l(this.playersContainerView.getElement(),t.getElement())),l(this.scoresContainerView.getElement(),this.totalScoresView.getElement())}}window.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("app"),t=new _,e=["John","Jack"];n&&new G(n,t,e).init()});
