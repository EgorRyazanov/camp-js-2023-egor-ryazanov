var m=Object.defineProperty;var d=(n,t,e)=>t in n?m(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(d(n,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";function i(n,t,e="beforeend"){n.insertAdjacentElement(e,t)}function c(n){const t=document.createElement("div");return t.innerHTML=n,t.firstChild}function u(n,t){n.replaceWith(t)}function p(n){return n.reduce((t,e)=>t+e,0)}class a{getElement(){return this.element}generateElement(t){return t!=null?c(t):c(this.template)}}class E extends a{constructor(e=[]){super();s(this,"points");s(this,"element");this.points=e,this.element=this.generateElement()}get template(){return`<div class="scores__total">
      <h4 class="total__title">Total</h4>
      <h4 class="total__scores">${p(this.points)}</h4>
      <div class="total__text-container">
        <p class="total__text">${this.points.join(" ")}</p>
      </div>
    </div>`}update(e){this.points.push(e.turnPoints);const r=this.element,l=this.generateElement();u(r,l),this.element=l}}class y extends a{constructor(e,r){super();s(this,"element");s(this,"points");s(this,"name");this.points=e,this.name=r,this.element=this.generateElement()}get template(){return this.getPlayerTemplate()}update(e){this.points=e.points;const r=this.element,l=this.generateElement(this.getPlayerTemplate(e.isWin,e.isNext));u(r,l),this.element=l}getPlayerTemplate(e=!1,r=!1){return`<li class="scores__player player">
      <h4 class="player__name ${r?"player__name_next":""}">${this.name}</h4>
      <h4 class="player__scores">Scores: ${p(this.points)}</h4>
      <div class="player__text-container ${e?"player__text-container_win":""}">
        <p class="player__text text">${this.points.join(" ")}</p>
      <div>
    </li>`}}class x extends a{constructor(){super();s(this,"element");this.element=this.generateElement()}get template(){return'<ul class="scores__players"></ul>'}}class w extends a{constructor(){super();s(this,"element");s(this,"events");this.element=this.generateElement(),this.events=[]}get template(){return'<button class="primary-button game__roll-button">Make roll</button>'}addEvents(e){e.forEach(r=>{this.element.addEventListener(r.name,r.callback),this.events.push(r)})}removeEvents(){this.events.forEach(e=>{this.element.removeEventListener(e.name,e.callback)})}}class b extends a{constructor(e){super();s(this,"element");s(this,"title");this.title=e,this.element=this.generateElement()}get template(){return`<h1 class="game__title title">${this.title}</h1>`}}class _ extends a{constructor(){super();s(this,"element");this.element=this.generateElement()}get template(){return'<div class="game__scores"></div>'}}class o{constructor(){s(this,"subscribers",[])}subscribe(t){this.subscribers.findIndex(r=>r===t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.findIndex(r=>r===t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}}class g extends o{constructor(e){super();s(this,"currentPlayerIndex");s(this,"playersCount");this.playersCount=e,this.currentPlayerIndex=-1}next(){this.currentPlayerIndex=this.calculateIndex();const e=this.calculateIndex();this.notify({nextPlayerIndex:e,currentPlayerIndex:this.currentPlayerIndex})}calculateIndex(){const e=this.currentPlayerIndex+1;return this.playersCount===e?0:e}}const V=21,h=1,f=6,I=1;class P extends o{constructor(){super()}update(t){const e=this.getRandomValue();this.notify({turnPoints:e,currentPlayerIndex:t.currentPlayerIndex,nextPlayerIndex:t.nextPlayerIndex})}getRandomValue(){return Math.floor(Math.random()*(f+I-h)+h)}}class S extends o{constructor(e,r){super();s(this,"name");s(this,"points");s(this,"isWin");s(this,"pointsSum");s(this,"sequenceIndex");this.name=e,this.sequenceIndex=r,this.points=[],this.isWin=!1,this.pointsSum=0}update(e){e.currentPlayerIndex===this.sequenceIndex&&(this.points.push(e.turnPoints),this.pointsSum+=e.turnPoints,this.pointsSum>=V&&(this.isWin=!0),this.notify({isWin:this.isWin,pointsSum:this.pointsSum,points:this.points})),e.nextPlayerIndex===this.sequenceIndex&&this.notify({isWin:this.isWin,isNext:!0,pointsSum:this.pointsSum,points:this.points})}}class C{constructor(t,e,r){s(this,"appElement");s(this,"playersContainerView");s(this,"rollButtonView");s(this,"playersGenerators");s(this,"playersViews");s(this,"totalScoresView");s(this,"titleView");s(this,"scoresContainerView");s(this,"turnGenerator");s(this,"diceGenerator");this.appElement=t,this.playersContainerView=e,this.totalScoresView=new E,this.rollButtonView=new w,this.titleView=new b("Blackjack game"),this.scoresContainerView=new _,this.turnGenerator=new g(r.length),this.diceGenerator=new P,this.playersGenerators=this.createPlayerGenerators(r),this.playersViews=this.createPlayersViews()}init(){this.makeEventSubscribes(),i(this.appElement,this.titleView.getElement()),i(this.appElement,this.rollButtonView.getElement()),i(this.appElement,this.scoresContainerView.getElement()),i(this.scoresContainerView.getElement(),this.playersContainerView.getElement()),this.playersViews.forEach(t=>i(this.playersContainerView.getElement(),t.getElement())),i(this.scoresContainerView.getElement(),this.totalScoresView.getElement())}createPlayerGenerators(t){return t.map((e,r)=>new S(e,r))}createPlayersViews(){const t=[];return this.playersGenerators.forEach(e=>{const r=new y(e.points,e.name);t.push(r),e.subscribe(r)}),t}makeEventSubscribes(){this.turnGenerator.subscribe(this.diceGenerator),this.diceGenerator.subscribe(this.totalScoresView),this.rollButtonView.addEvents([{name:"click",callback:()=>this.turnGenerator.next()}]),this.playersGenerators.forEach(t=>this.diceGenerator.subscribe(t))}}window.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector("#app"),t=new x,e=["John","Jack"];if(n==null)throw Error("Element not found");new C(n,t,e).init()});
